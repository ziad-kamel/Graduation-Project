<script>
/* var replicat output = {
    "id": "xsyitubbyg7ik7mollqa6xl3ni",
    "model": "openai/whisper",
    "version": "4d50797290df275329f202e48c76360b3f22b08d28c196cbc54600319435f8d2",
    "input": {
        "audio": "https://replicate.delivery/mgxm/e5159b1b-508a-4be4-b892-e1eb47850bdc/OSR_uk_000_0050_8k.wav"
    },
    "logs": "Transcribe with large-v3 model.\nDetected language: English\n  0%|          | 0/5241 [00:00<?, ?frames/s]\n 35%|███▌      | 1860/5241 [00:02<00:05, 634.50frames/s]\n 93%|█████████▎| 4860/5241 [00:08<00:00, 596.97frames/s]\n100%|██████████| 5241/5241 [00:09<00:00, 536.44frames/s]\n100%|██████████| 5241/5241 [00:09<00:00, 559.61frames/s]\n",
    "output": {
        "detected_language": "english",
        "segments": [
            {
                "avg_logprob": -0.060722851171726135,
                "compression_ratio": 1.412280701754386,
                "end": 18.6,
                "id": 0,
                "no_speech_prob": 0.05907342955470085,
                "seek": 0,
                "start": 0,
                "temperature": 0,
                "text": " the little tales they tell are false the door was barred locked and bolted as well ripe pears are fit for a queen's table a big wet stain was on the round carpet",
                "tokens": [
                    50365,
                    264,
                    707,
                    27254,
                    436,
                    980,
                    366,
                    7908,
                    264,
                    2853,
                    390,
                    2159,
                    986,
                    9376,
                    293,
                    13436,
                    292,
                    382,
                    731,
                    31421,
                    520,
                    685,
                    366,
                    3318,
                    337,
                    257,
                    12206,
                    311,
                    3199,
                    257,
                    955,
                    6630,
                    16441,
                    390,
                    322,
                    264,
                    3098,
                    18119,
                    51295
                ]
            },
            {
                "avg_logprob": -0.1184891973223005,
                "compression_ratio": 1.696969696969697,
                "end": 31.840000000000003,
                "id": 1,
                "no_speech_prob": 0.000253104604780674,
                "seek": 1860,
                "start": 18.6,
                "temperature": 0,
                "text": " the kite dipped and swayed but stayed aloft the pleasant hours fly by much too soon the room was crowded with a mild wab",
                "tokens": [
                    50365,
                    264,
                    38867,
                    45162,
                    293,
                    27555,
                    292,
                    457,
                    9181,
                    419,
                    6750,
                    264,
                    16232,
                    2496,
                    3603,
                    538,
                    709,
                    886,
                    2321,
                    264,
                    1808,
                    390,
                    21634,
                    365,
                    257,
                    15154,
                    261,
                    455,
                    51027
                ]
            },
            {
                "avg_logprob": -0.1184891973223005,
                "compression_ratio": 1.696969696969697,
                "end": 45.2,
                "id": 2,
                "no_speech_prob": 0.000253104604780674,
                "seek": 1860,
                "start": 31.840000000000003,
                "temperature": 0,
                "text": " the room was crowded with a wild mob this strong arm shall shield your honour she blushed when he gave her a white orchid",
                "tokens": [
                    51027,
                    264,
                    1808,
                    390,
                    21634,
                    365,
                    257,
                    4868,
                    4298,
                    341,
                    2068,
                    3726,
                    4393,
                    10257,
                    428,
                    20631,
                    750,
                    25218,
                    292,
                    562,
                    415,
                    2729,
                    720,
                    257,
                    2418,
                    34850,
                    327,
                    51695
                ]
            },
            {
                "avg_logprob": -0.1184891973223005,
                "compression_ratio": 1.696969696969697,
                "end": 48.6,
                "id": 3,
                "no_speech_prob": 0.000253104604780674,
                "seek": 1860,
                "start": 45.2,
                "temperature": 0,
                "text": " the beetle droned in the hot june sun",
                "tokens": [
                    51695,
                    264,
                    49735,
                    1224,
                    19009,
                    294,
                    264,
                    2368,
                    361,
                    2613,
                    3295,
                    51865
                ]
            },
            {
                "avg_logprob": -0.7403042793273926,
                "compression_ratio": 0.5294117647058824,
                "end": 52.4,
                "id": 4,
                "no_speech_prob": 0.292143315076828,
                "seek": 4860,
                "start": 48.6,
                "temperature": 0.2,
                "text": " thank you",
                "tokens": [
                    50365,
                    1309,
                    291,
                    50555
                ]
            }
        ],
        "transcription": " the little tales they tell are false the door was barred locked and bolted as well ripe pears are fit for a queen's table a big wet stain was on the round carpet the kite dipped and swayed but stayed aloft the pleasant hours fly by much too soon the room was crowded with a mild wab the room was crowded with a wild mob this strong arm shall shield your honour she blushed when he gave her a white orchid the beetle droned in the hot june sun thank you",
        "translation": null
    },
    "error": null,
    "status": "succeeded",
    "created_at": "2024-03-03T19:45:50.088178Z",
    "started_at": "2024-03-03T19:45:50.108989Z",
    "completed_at": "2024-03-03T19:46:00.20845Z",
    "urls": {
        "cancel": "https://api.replicate.com/v1/predictions/xsyitubbyg7ik7mollqa6xl3ni/cancel",
        "get": "https://api.replicate.com/v1/predictions/xsyitubbyg7ik7mollqa6xl3ni"
    },
    "metrics": {
        "predict_time": 10.099461
    }
}
*/

    import { STT_Language } from '../../../lib/utils/types';
    import './STT.scss';
    

    
    var fileURL;
    var language;
    var task;


    const setFile = async (file) => {
        let myBlob = new Blob([await file.arrayBuffer()], { type: "audio/mpeg" });
        let audioURL = URL.createObjectURL(myBlob);
        fileURL = audioURL
    }

    const  onSubmitClicked = async () => {
        language = document.getElementById('select-language').value

    }
</script>

<div class="stt-main hidden">
    <h1>Speech To Text</h1>
    <input type='file' on:change={(e) => {setFile(e.target.files?.[0])}}/>
    
    <div>
        <select id="select-language">
            {#each STT_Language as sst_language}
                <option>
                    {sst_language.audioLanguage}
                </option>
            {/each}
        </select>
    </div>

    <button on:click = {onSubmitClicked}>Generate</button>

    {#if fileURL}
    <audio controls>
        <source src={fileURL}/>
    </audio>
    {/if}

</div>
